function Client(a,b,c,d){this.STACKMOB_APP_NAME=a,this.STACKMOB_PUBLIC_KEY=b,this.STACKMOB_PRIVATE_KEY=c,this.STACKMOB_USER_OBJECT_NAME=d||"user",this.ENDPOINT="http://stackmob.mob1.stackmob.com/api/0/"+a+"/",this.oauth=OAuth({consumerKey:b,consumerSecret:c}),Ti.API.debug(JSON.stringify(this))}function handleOptions(a,b,c){var d,e={};for(d in b)b.hasOwnProperty(d)&&(d in a?e[b[d]]=a[d]:d in c&&(e[b[d]]=c[d]));return e}function optionsToQueryString(a,b,c){var d=handleOptions(a,b,c),e=[],f;for(f in d)e.push(f+"="+d[f]);return"?"+e.join("&")}var exports=exports||this,OAuth=function(a){function b(a){var b=arguments,c=b.callee,d=b.length,e,f=this;if(this instanceof c){for(e in a)a.hasOwnProperty(e)&&(f[e]=a[e]);return f}return new c(a)}function c(){}function d(a){var b=arguments,c=b.callee,d,f,g,h,i,j,k,l=/^([^:\/?#]+?:\/\/)*([^\/:?#]*)?(:[^\/?#]*)*([^?#]*)(\?[^#]*)?(#(.*))*/,m=this;if(!(this instanceof c))return new c(a);m.scheme="",m.host="",m.port="",m.path="",m.query=new e,m.anchor="";if(a!==null){d=a.match(l),f=d[1],g=d[2],h=d[3],i=d[4],j=d[5],k=d[6],f=f!==undefined?f.replace("://","").toLowerCase():"http",h=h?h.replace(":",""):f==="https"?"443":"80",f=f=="http"&&h==="443"?"https":f,j=j?j.replace("?",""):"",k=k?k.replace("#",""):"";if(f==="https"&&h!=="443"||f==="http"&&h!=="80")g=g+":"+h;m.scheme=f,m.host=g,m.port=h,m.path=i||"/",m.query.setQueryParams(j),m.anchor=k||""}}function e(a){var b=arguments,c=b.callee,d=b.length,e,f=this;if(this instanceof c){if(a!=undefined)for(e in a)a.hasOwnProperty(e)&&(f[e]=a[e]);return f}return new c(a)}function g(a){return this instanceof g?this.init(a):new g(a)}function h(a){var b=[],c,d;for(c in a)a[c]&&a[c]!==undefined&&a[c]!==""&&(c==="realm"?d=c+'="'+a[c]+'"':b.push(c+'="'+g.urlEncode(a[c]+"")+'"'));return b.sort(),d&&b.unshift(d),b.join(", ")}function i(a,b,c,d){var e=[],f,h=g.urlEncode;for(f in c)c[f]!==undefined&&c[f]!==""&&e.push(g.urlEncode(f)+"="+g.urlEncode(c[f]+""));for(f in d)d[f]!==undefined&&d[f]!==""&&(c[f]||e.push(h(f)+"="+h(d[f]+"")));return[a,h(b),h(e.sort().join("&"))].join("&")}function j(){return parseInt(+(new Date)/1e3,10)}function k(a){function b(){return Math.floor(Math.random()*h.length)}a=a||64;var c=a/8,d="",e=c/4,f=c%4,g,h=["20","21","22","23","24","25","26","27","28","29","2A","2B","2C","2D","2E","2F","30","31","32","33","34","35","36","37","38","39","3A","3B","3C","3D","3E","3F","40","41","42","43","44","45","46","47","48","49","4A","4B","4C","4D","4E","4F","50","51","52","53","54","55","56","57","58","59","5A","5B","5C","5D","5E","5F","60","61","62","63","64","65","66","67","68","69","6A","6B","6C","6D","6E","6F","70","71","72","73","74","75","76","77","78","79","7A","7B","7C","7D","7E"];for(g=0;g<e;g++)d+=h[b()]+h[b()]+h[b()]+h[b()];for(g=0;g<f;g++)d+=h[b()];return d}function l(){var a;return a=Titanium.Network.createHTTPClient(),a}function m(a){var b=new Array(++a);return b.join(0).split("")}function n(a){var b=[],c,d;for(d=0;d<a.length;d++)c=a.charCodeAt(d),c<128?b.push(c):c<2048?b.push(192+(c>>6),128+(c&63)):c<65536?b.push(224+(c>>12),128+(c>>6&63),128+(c&63)):c<2097152&&b.push(240+(c>>18),128+(c>>12&63),128+(c>>6&63),128+(c&63));return b}function o(a){var b=[],c;for(c=0;c<a.length*32;c+=8)b.push(a[c>>>5]>>>24-c%32&255);return b}function p(a){var b=[],c=a.length,d;for(d=0;d<c;d++)b.push((a[d]>>>4).toString(16)),b.push((a[d]&15).toString(16));return b.join("")}function q(a){var b="",c=a.length,d;for(d=0;d<c;d++)b+=String.fromCharCode(a[d]);return b}function r(a,b){return a<<b|a>>>32-b}function s(a){if(a!==undefined){var b=a,c,d;return b.constructor===String&&(b=n(b)),this instanceof s?c=this:c=new s(a),d=c.hash(b),p(d)}return this instanceof s?this:new s}function t(a,b,c,d){var e=n(b),f=n(c),g=e.length,h,i,j,k;g>a.blocksize&&(e=a.hash(e),g=e.length),e=e.concat(m(a.blocksize-g)),i=e.slice(0),j=e.slice(0);for(k=0;k<a.blocksize;k++)i[k]^=92,j[k]^=54;return h=a.hash(i.concat(a.hash(j.concat(f)))),d?p(h):q(h)}c.prototype={join:function(a){return a=a||"",this.values().join(a)},keys:function(){var a,b=[],c=this;for(a in c)c.hasOwnProperty(a)&&b.push(a);return b},values:function(){var a,b=[],c=this;for(a in c)c.hasOwnProperty(a)&&b.push(c[a]);return b},shift:function(){throw"not implimented"},unshift:function(){throw"not implimented"},push:function(){throw"not implimented"},pop:function(){throw"not implimented"},sort:function(){throw"not implimented"},ksort:function(a){var b=this,c=b.keys(),d,e,f;a==undefined?c.sort():c.sort(a);for(d=0;d<c.length;d++)f=c[d],e=b[f],delete b[f],b[f]=e;return b},toObject:function(){var a={},b,c=this;for(b in c)c.hasOwnProperty(b)&&(a[b]=c[b]);return a}},b.prototype=new c,d.prototype={scheme:"",host:"",port:"",path:"",query:"",anchor:"",toString:function(){var a=this,b=a.query+"";return a.scheme+"://"+a.host+a.path+(b!=""?"?"+b:"")+(a.anchor!==""?"#"+a.anchor:"")}},e.prototype=new b,e.prototype.toString=function(){var a,b=this,c=[],d="",e="",f=g.urlEncode;b.ksort();for(a in b)b.hasOwnProperty(a)&&a!=undefined&&b[a]!=undefined&&(e=f(a)+"="+f(b[a]),c.push(e));return c.length>0&&(d=c.join("&")),d},e.prototype.setQueryParams=function(a){var b=arguments,c=b.length,d,e,f,g=this,h;if(c==1){if(typeof a=="object")for(d in a)a.hasOwnProperty(d)&&(g[d]=a[d]);else if(typeof a=="string"){e=a.split("&");for(d=0,f=e.length;d<f;d++)h=e[d].split("="),g[h[0]]=h[1]}}else for(d=0;d<arg_length;d+=2)g[b[d]]=b[d+1]};var f="1.0";return g.prototype={realm:"",requestTokenUrl:"",authorizationUrl:"",accessTokenUrl:"",init:function(a){var b="",c={enablePrivilege:a.enablePrivilege||!1,callbackUrl:a.callbackUrl||"oob",consumerKey:a.consumerKey,consumerSecret:a.consumerSecret,accessTokenKey:a.accessTokenKey||b,accessTokenSecret:a.accessTokenSecret||b,verifier:b,signatureMethod:a.signatureMethod||"HMAC-SHA1"};return this.realm=a.realm||b,this.requestTokenUrl=a.requestTokenUrl||b,this.authorizationUrl=a.authorizationUrl||b,this.accessTokenUrl=a.accessTokenUrl||b,this.getAccessToken=function(){return[c.accessTokenKey,c.accessTokenSecret]},this.getAccessTokenKey=function(){return c.accessTokenKey},this.getAccessTokenSecret=function(){return c.accessTokenSecret},this.setAccessToken=function(a,b){b&&(a=[a,b]),c.accessTokenKey=a[0],c.accessTokenSecret=a[1]},this.getVerifier=function(){return c.verifier},this.setVerifier=function(a){c.verifier=a},this.setCallbackUrl=function(a){c.callbackUrl=a},this.request=function(a){var b,e,m,n,o,p,q,r,s,t,u,v,w=[],x,y={},z,A;b=a.method||"GET",e=d(a.url),m=a.data||{},n=a.headers||{},o=a.success||function(){},p=a.failure||function(){},A=function(){var a=!1;for(var b in m)typeof m[b].fileName!="undefined"&&(a=!0);return a}(),x=a.appendQueryString?a.appendQueryString:!1,c.enablePrivilege&&netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead UniversalBrowserWrite"),q=l(),q.onreadystatechange=function(){if(q.readyState===4){var a=/^(.*?):\s*(.*?)\r?$/mg,b=n,c={},d="",e;if(!q.getAllResponseHeaders){if(!!q.getResponseHeaders){d=q.getResponseHeaders();for(var f=0,g=d.length;f<g;++f)c[d[f][0]]=d[f][1]}}else{d=q.getAllResponseHeaders();while(e=a.exec(d))c[e[1]]=e[2]}var h={text:q.responseText,requestHeaders:b,responseHeaders:c};q.status>=200&&q.status<=226||q.status==304||q.status===0?o(h):q.status>=400&&q.status!==0&&p(h)}},s={oauth_callback:c.callbackUrl,oauth_consumer_key:c.consumerKey,oauth_token:c.accessTokenKey,oauth_signature_method:c.signatureMethod,oauth_timestamp:j(),oauth_nonce:k(),oauth_verifier:c.verifier,oauth_version:f},t=c.signatureMethod;if((!("Content-Type"in n)||n["Content-Type"]=="application/x-www-form-urlencoded")&&!A){z=e.query.toObject();for(r in z)y[r]=z[r];for(r in m)y[r]=m[r]}urlString=e.scheme+"://"+e.host+e.path,u=i(b,urlString,s,y),v=g.signatureMethod[t](c.consumerSecret,c.accessTokenSecret,u),s.oauth_signature=v,this.realm&&(s.realm=this.realm);if(x||b=="GET")e.query.setQueryParams(m),w=null;else if(!A)if(typeof m=="string")w=m,"Content-Type"in n||(n["Content-Type"]="text/plain");else{for(r in m)w.push(g.urlEncode(r)+"="+g.urlEncode(m[r]+""));w=w.sort().join("&"),"Content-Type"in n||(n["Content-Type"]="application/x-www-form-urlencoded")}else if(A){w=new FormData;for(r in m)w.append(r,m[r])}q.open(b,e+"",!0),q.setRequestHeader("Authorization","OAuth "+h(s)),q.setRequestHeader("X-Requested-With","XMLHttpRequest");for(r in n)q.setRequestHeader(r,n[r]);q.send(w)},this},get:function(a,b,c){this.request({url:a,success:b,failure:c})},post:function(a,b,c,d){this.request({method:"POST",url:a,data:b,success:c,failure:d})},getJSON:function(a,b,c){this.get(a,function(a){b(JSON.parse(a.text))},c)},postJSON:function(a,b,c,d){this.post(a,JSON.stringify(b),function(a){c(JSON.parse(a.text))},d)},parseTokenRequest:function(a){var b=0,c=a.split("&"),d=c.length,e={};for(;b<d;++b){var f=c[b].split("=");e[g.urlDecode(f[0])]=g.urlDecode(f[1])}return e},fetchRequestToken:function(a,b){var c=this;c.setAccessToken("","");var d=c.authorizationUrl;this.get(this.requestTokenUrl,function(b){var e=c.parseTokenRequest(b.text);c.setAccessToken([e.oauth_token,e.oauth_token_secret]),a(d+"?"+b.text)},b)},fetchAccessToken:function(a,b){var c=this;this.get(this.accessTokenUrl,function(b){var d=c.parseTokenRequest(b.text);c.setAccessToken([d.oauth_token,d.oauth_token_secret]),c.setVerifier(""),a(b)},b)}},g.signatureMethod={"HMAC-SHA1":function(b,c,d){var e,f,h=g.urlEncode;return b=h(b),c=h(c||""),e=b+"&"+c,f=t(s.prototype,e,d),a.btoa(f)}},g.urlEncode=function(a){function b(a){var b=a.toString(16).toUpperCase();return b.length<2&&(b=0+b),"%"+b}if(!a)return"";a=a+"";var c=/[ \r\n!*"'();:@&=+$,\/?%#\[\]<>{}|`^\\\u0080-\uffff]/,d=a.length,e,f=a.split(""),g;for(e=0;e<d;e++)if(g=f[e].match(c))g=g[0].charCodeAt(0),g<128?f[e]=b(g):g<2048?f[e]=b(192+(g>>6))+b(128+(g&63)):g<65536?f[e]=b(224+(g>>12))+b(128+(g>>6&63))+b(128+(g&63)):g<2097152&&(f[e]=b(240+(g>>18))+b(128+(g>>12&63))+b(128+(g>>6&63))+b(128+(g&63)));return f.join("")},g.urlDecode=function(a){return a?a.replace(/%[a-fA-F0-9]{2}/ig,function(a){return String.fromCharCode(parseInt(a.replace("%",""),16))}):""},s.prototype=new s,s.prototype.blocksize=64,s.prototype.hash=function(a){function A(a,b,c,d){switch(a){case 0:return b&c|~b&d;case 1:case 3:return b^c^d;case 2:return b&c|b&d|c&d}return-1}var b=[1732584193,4023233417,2562383102,271733878,3285377520],c=[1518500249,1859775393,2400959708,3395469782],d,e,f,g,h,i,j,k,l,p,q,s,t,u,v,w,x,y,z;a.constructor===String&&(a=n(a.encodeUTF8())),f=a.length,g=Math.ceil((f+9)/this.blocksize)*this.blocksize-(f+9),e=Math.floor(f/4294967296),d=Math.floor(f%4294967296),h=[e*8>>24&255,e*8>>16&255,e*8>>8&255,e*8&255,d*8>>24&255,d*8>>16&255,d*8>>8&255,d*8&255],a=a.concat([128],m(g),h),i=Math.ceil(a.length/this.blocksize);for(j=0;j<i;j++){k=a.slice(j*this.blocksize,(j+1)*this.blocksize),l=k.length,p=[];for(q=0;q<l;q++)p[q>>>2]|=k[q]<<24-(q-(q>>2)*4)*8;s=b[0],t=b[1],u=b[2],v=b[3],w=b[4];for(x=0;x<80;x++)x>=16&&(p[x]=r(p[x-3]^p[x-8]^p[x-14]^p[x-16],1)),y=Math.floor(x/20),z=r(s,5)+A(y,t,u,v)+w+c[y]+p[x],w=v,v=u,u=r(t,30),t=s,s=z;b[0]+=s,b[1]+=t,b[2]+=u,b[3]+=v,b[4]+=w}return o(b)},g}(this);(function(a){var b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";a.btoa=a.btoa||function(a){var c=0,d=a.length,e,f,g="";for(;c<d;c+=3)e=[a.charCodeAt(c),a.charCodeAt(c+1),a.charCodeAt(c+2)],f=[e[0]>>2,(e[0]&3)<<4|e[1]>>4,(e[1]&15)<<2|e[2]>>6,e[2]&63],isNaN(e[1])&&(f[2]=64),isNaN(e[2])&&(f[3]=64),g+=b.charAt(f[0])+b.charAt(f[1])+b.charAt(f[2])+b.charAt(f[3]);return g}})(this),Client.prototype.request=function(a){var b=this,c={};c=extend(c,a.headers);if(a.method==="PUT"||a.method==="POST")c=extend(c,{"Content-Type":"application/json"});var d={method:a.method,headers:c,url:b.ENDPOINT+a.action,data:a.method==="PUT"||a.method==="POST"?JSON.stringify(a.params):a.params,success:function(b){var c=JSON.stringify(b);a.success!==undefined&&a.success(b)},failure:function(b){var c=JSON.stringify(b);Ti.API.error(String.format("fail: %s - %s",a.action,c)),a.error!==undefined&&a.error(b)}};b.oauth.request(d)},Client.prototype.create=function(a){this.request({action:a.className,method:"POST",params:a.params,success:a.success,error:a.error,headers:a.headers})},Client.prototype.linkUserWithTwitter=function(a){this.request({action:(a.className||"user")+"/linkUserWithTwitter",method:"GET",params:{tw_ts:Ti.App.Properties.getString("TwitterOAuthTokenSecret"),tw_tk:Ti.App.Properties.getString("TwitterOAuthTokenKey")},success:a.success,error:a.error,headers:a.headers})},Client.prototype.twitterStatusUpdate=function(a){this.request({action:(a.className||"user")+"/twitterStatusUpdate",method:"GET",params:{tw_st:a.message},success:a.success||a.success,error:a.error||a.error,headers:a.headers||a.headers})},Client.prototype.login=function(a){this.request({action:(a.className||"user")+"/login",method:"GET",params:{username:a.username,password:a.password},success:a.success,error:a.error,headers:a.headers})},Client.prototype.get=function(a){this.request({action:a.className+(a.objectId?"/"+a.objectId:""),method:"GET",params:a.params,success:a.success,error:a.error,headers:a.headers})},Client.prototype.getNear=function(a){var b={"location[near]":a.params.lon+","+a.params.lat+","+(a.params.dist_miles?a.params.dist_miles/3963:a.params.dist)};this.request({action:a.className,method:"GET",params:b,success:a.success,error:a.error,headers:a.headers})},Client.prototype.getWithin=function(a){var b,c={};b=a.params.dist_miles?a.params.dist_miles/3963:a.params.dist,a.params.lon!==null&&a.params.lat?c={"location[near]":a.params.lon+","+a.params.lat+","+b}:c={"location[within]":a.params.bottomLeft.lon+","+a.params.bottomLeft.lat+","+a.params.topRight.lon+","+a.params.topRight.lat+","+b},this.request({action:a.className,method:"GET",params:c,success:a.success,error:a.error,headers:a.headers})},Client.prototype.update=function(a){this.request({action:a.className+"/"+encodeURIComponent(a.objectId),method:"PUT",params:a.params,success:a.success,error:a.error,headers:a.headers})},Client.prototype.remove=function(a){this.request({action:a.className+"/"+a.objectId,method:"DELETE",success:a.success,error:a.error,headers:a.headers})},exports.base64FromFile=function(a){var b=Titanium.Platform.osname=="android",c=a.read();if(b)return String.format("Content-Type: %s\nContent-Transfer-Encoding: base64\n\n%s",c.mimeType,c.toBase64());var d=require("com.clearlyinnovative.utils");return String.format("Content-Type: %s\nContent-Transfer-Encoding: base64\n\n%s",c.mimeType,d.base64encode(c))};var extend=function(a,b){if(arguments.length>2)for(var c=1;c<arguments.length;c++)extend(a,arguments[c]);else for(var d in b)a[d]=b[d];return a};OAuth.Twitter=function(a){if(!(this instanceof OAuth.Twitter))return new OAuth.Twitter(a);var b=Ti.App.Properties,c=b.hasProperty("TwitterOAuthTokenKey")?b.getString("TwitterOAuthTokenKey"):"",d=b.hasProperty("TwitterOAuthTokenSecret")?b.getString("TwitterOAuthTokenSecret"):"";"accessTokenKey"in a||(a.accessTokenKey=c,a.accessTokenSecret=d),a.requestTokenUrl=OAuth.Twitter.API_URL+OAuth.Twitter.API_OAUTH_REQUEST_TOKEN,a.authorizationUrl=OAuth.Twitter.API_URL+OAuth.Twitter.API_OAUTH_AUTHENTICATE,a.accessTokenUrl=OAuth.Twitter.API_URL+OAuth.Twitter.API_OAUTH_ACCESS_TOKEN,a.callbackUrl="http://bytespider.eu/oauth/",this.oauth=new OAuth(a)},OAuth.Twitter.API_OAUTH_AUTHORISE="oauth/authorize",OAuth.Twitter.API_OAUTH_AUTHENTICATE="oauth/authenticate",OAuth.Twitter.API_OAUTH_ACCESS_TOKEN="oauth/access_token",OAuth.Twitter.API_OAUTH_REQUEST_TOKEN="oauth/request_token",OAuth.Twitter.API_URL="https://api.twitter.com/",OAuth.Twitter.API_UPLOAD_URL="https://upload.twitter.com/",OAuth.Twitter.API_VERSION="1",OAuth.Twitter.API_FORMAT="json",OAuth.Twitter.API_VARIFY_CREDENTIALS="/account/verify_credentials",OAuth.Twitter.API_HOME_TIMELINE="/statuses/home_timeline",OAuth.Twitter.API_USER_TIMELINE="/statuses/user_timeline",OAuth.Twitter.API_PUBLIC_TIMELINE="/statuses/public_timeline",OAuth.Twitter.API_MENTIONS="/statuses/mentions",OAuth.Twitter.API_RETWEETED_BY_ME="/statuses/retweeted_by_me",OAuth.Twitter.API_RETWEETS_OF_ME="/statuses/retweets_of_me",OAuth.Twitter.API_RETWEETED_TO_USER="/statuses/retweeted_to_user",OAuth.Twitter.API_RETWEETED_BY_USER="/statuses/retweeted_by_user",OAuth.Twitter.API_STATUS_UPDATE="/statuses/update",OAuth.Twitter.API_STATUS_UPDATE_WITH_MEDIA="/statuses/update_with_media",OAuth.Twitter.API_TWEET="/statuses/retweet/",OAuth.Twitter.API_RETWEET="/statuses/retweet/",OAuth.Twitter.API_DESTROY_TWEET="/statuses/destroy/",OAuth.Twitter.API_MESSAGES="/direct_messages",OAuth.Twitter.API_NEW_MESSAGE="/direct_messages/new",OAuth.Twitter.API_MESSAGE="/direct_messages/",OAuth.Twitter.UI=function(){var a,b=Titanium.UI.createButton({title:"Cancel"}),c,d;return a=Titanium.UI.createWindow({title:"Twitter",leftNavButton:b}),b.addEventListener("click",function(a){OAuth.Twitter.UI.hide(),d&&d("cancelled")}),{show:function(b,e,f){var g=this;c=e,d=f;var h=Ti.UI.createWebView({autoDetect:[Ti.UI.AUTODETECT_NONE],url:b});a.add(h),h.addEventListener("load",function(b){var e=b.url;if(e.indexOf("oauth_verifier")==-1&&e.indexOf("denied")==-1)return;if(e.indexOf("denied")!=-1){OAuth.Twitter.UI.hide(),a.remove(h),d&&d(e);return}if(e.indexOf("oauth_verifier")!=-1){OAuth.Twitter.UI.hide(),a.remove(h),c&&c(e);return}}),a.open({modal:!0,modalTransitionStyle:Ti.UI.iPhone.MODAL_TRANSITION_STYLE_COVER_VERTICAL,modalStyle:Ti.UI.iPhone.MODAL_PRESENTATION_FORMSHEET})},hide:function(){a.close()}}}(),OAuth.Twitter.prototype={authenticate:function(a,b,c){c=c||{};var d=this;if(!a)throw new Error("Success callback is required in authenticate()");if("username"in c&&"password"in c){var e=OAuth.Twitter.API_URL+OAuth.Twitter.API_OAUTH_ACCESS_TOKEN;d.oauth.post(e,{x_auth_username:c.username,x_auth_password:c.password,x_auth_mode:"client_auth"},a,b)}else d.oauth.fetchRequestToken(function(c){OAuth.Twitter.UI.show(c,function(c){var e=c.substr(c.indexOf("?")),f=d.oauth.parseTokenRequest(e);d.oauth.setVerifier(f.oauth_verifier),d.oauth.fetchAccessToken(function(b){d.storeToken.call(d),a(b)},b)},b)},function(a){OAuth.Twitter.UI.hide.call(d),b&&b(a)});return this},deauthenticate:function(){return this.oauth.setAccessToken(null,null),Ti.App.Properties.removeProperty("TwitterOAuthTokenKey"),Ti.App.Properties.removeProperty("TwitterOAuthTokenSecret"),this},storeToken:function(){var a=this.oauth.getAccessTokenKey(),b=this.oauth.getAccessTokenSecret();Ti.App.Properties.setString("TwitterOAuthTokenKey",a),Ti.App.Properties.setString("TwitterOAuthTokenSecret",b)},signedIn:function(){var a=!1,b=!1,c=Ti.App.Properties;return c.hasProperty("TwitterOAuthTokenKey")&&(a=c.getString("TwitterOAuthTokenKey")),c.hasProperty("TwitterOAuthTokenSecret")&&(b=c.getString("TwitterOAuthTokenSecret")),a!==!1&&b!==!1},verifyCredentials:function(a,b,c){c=c||{};var d=OAuth.Twitter.API_URL+OAuth.Twitter.API_VERSION+OAuth.Twitter.API_VARIFY_CREDENTIALS+"."+OAuth.Twitter.API_FORMAT,e={},f={};return d+=optionsToQueryString(c,e,f),this.oauth.getJSON(d,a,b),this},homeTimeline:function(a,b,c,d){d=d||{};var e=OAuth.Twitter.API_URL+OAuth.Twitter.API_VERSION+OAuth.Twitter.API_HOME_TIMELINE+"."+OAuth.Twitter.API_FORMAT;a!==null&&(d.sinceid=a);var f={sinceId:"since_id",count:"count",page:"page",maxId:"max_id",trimUser:"trim_user",includeRetweets:"include_rts",includeEntities:"include_entities",excludeReplies:"exclude_replies",contributorDetails:"contributor_details"},g={trimUser:!0,includeRetweets:!0,includeEntities:!0,excludeReplies:!1,contributorDetails:!0};return e+=optionsToQueryString(d,f,g),this.oauth.getJSON(e,b,c),this},userTimeline:function(a,b,c,d,e){e=e||{};var f=OAuth.Twitter.API_URL+OAuth.Twitter.API_VERSION+OAuth.Twitter.API_USER_TIMELINE+"."+OAuth.Twitter.API_FORMAT,g=parseInt(a,10);g==a?e.userId=g:e.screenName=a;var h={screenName:"screen_name",userId:"user_id",count:"count",page:"page",maxId:"max_id",trimUser:"trim_user",includeRetweets:"include_rts",includeEntities:"include_entities",excludeReplies:"exclude_replies",contributorDetails:"contributor_details"},i={trimUser:!0,includeRetweets:!0,includeEntities:!0,excludeReplies:!1,contributorDetails:!0};return f+=optionsToQueryString(e,h,i),this.oauth.getJSON(f,c,d),this},mentions:function(a,b,c){c=c||{};var d=OAuth.Twitter.API_URL+OAuth.Twitter.API_VESRION+OAuth.Twitter.API_MENTIONS+"."+OAuth.Twitter.API_FORMAT,e={count:"count",page:"page",maxId:"max_id",trimUser:"trim_user",includeRetweets:"include_rts",includeEntities:"include_entities",excludeReplies:"exclude_replies",contributorDetails:"contributor_details"},f={trimUser:!0,includeRetweets:!0,includeEntities:!0,excludeReplies:!1,contributorDetails:!0};return d+=optionsToQueryString(c,e,f),this.oauth.getJSON(d,a,b),this},messages:function(a,b,c){c=c||{};var d=OAuth.Twitter.API_URL+OAuth.Twitter.API_VESRION+OAuth.Twitter.API_MESSAGES+"."+OAuth.Twitter.API_FORMAT,e={count:"count",page:"page",maxId:"max_id",sinceId:"since_id",includeEntities:"include_entities",skipStatus:"skip_status"},f={skipStatus:!0,includeEntities:!0};return d+=optionsToQueryString(c,e,f),this.oauth.getJSON(d,a,b),this},createMessage:function(a,b,c){c=c||{};var d=OAuth.Twitter.API_URL+OAuth.Twitter.API_VESRION+OAuth.Twitter.API_NEW_MESSAGE+"."+OAuth.Twitter.API_FORMAT,e={userId:"user_id",screenName:"screen_name",text:"text",wrapLinks:"wrap_links"},f={wrapLinks:!0},g=handleOptions(c,e,f);return this.oauth.post(d,g,function(b){a(JSON.parse(b.text))},b),this},showMessage:function(a,b,c,d){d=d||{};var e=OAuth.Twitter.API_URL+OAuth.Twitter.API_VESRION+OAuth.Twitter.API_MESSAGE+a+"."+OAuth.Twitter.API_FORMAT,f={},g={};return e+=optionsToQueryString(d,f,g),this.oauth.getJSON(e,b,c),this},retweets:function(a,b,c){c=c||{};var d=OAuth.Twitter.API_URL+OAuth.Twitter.API_VESRION+OAuth.Twitter.API_RETWEETS_OF_ME+"."+OAuth.Twitter.API_FORMAT,e={count:"count",page:"page",maxId:"max_id",trimUser:"trim_user",includeEntities:"include_entities"},f={trimUser:!0,includeEntities:!0};return d+=optionsToQueryString(c,e,f),this.oauth.getJSON(d,a,b),this},retweetsByMe:function(a,b,c){c=c||{};var d=OAuth.Twitter.API_URL+OAuth.Twitter.API_VESRION+OAuth.Twitter.API_RETWEETED_BY_ME+"."+OAuth.Twitter.API_FORMAT,e={count:"count",page:"page",maxId:"max_id",trimUser:"trim_user",includeEntities:"include_entities"},f={trimUser:!0,includeEntities:!0};return d+=optionsToQueryString(c,e,f),this.oauth.getJSON(d,a,b),this},tweet:function(a,b,c,d){d=d||{};var e=OAuth.Twitter.API_URL+OAuth.Twitter.API_VERSION+OAuth.Twitter.API_STATUS_UPDATE+"."+OAuth.Twitter.API_FORMAT;if(!a)throw new Error("Missing 'status' in tweet()");d.status=a;var f={status:"status",inReplyTo:"in_reply_to_status_id",lat:"lat","long":"long",place:"place_id",displayCoordinates:"display_coordinates",trimUser:"trim_user",includeEntities:"include_entities",wrap_linksinks:"wrap_links"},g={trimUser:!0,includeEntities:!0,wrapLinks:!0},h=handleOptions(d,f,g);return this.oauth.post(e,h,function(a){b(JSON.parse(a.text))},c),this},tweetWithMedia:function(a,b,c,d,e){e=e||{};var f=OAuth.Twitter.API_UPLOAD_URL+OAuth.Twitter.API_VERSION+OAuth.Twitter.API_STATUS_UPDATE_WITH_MEDIA+"."+OAuth.Twitter.API_FORMAT;if("status"in e){if("media"in e){e.status=a,e.media=b;var g={status:"status",media:"media",possiblySensitive:"possibly_sensitive",inReplyTo:"in_reply_to_status_id",lat:"lat","long":"long",place:"place_id",displayCoordinates:"display_coordinates",trimUser:"trim_user",includeEntities:"include_entities",wrap_linksinks:"wrap_links"},h={trimUser:!0,includeEntities:!0,wrapLinks:!0},i=handleOptions(e,g,h);return this.oauth.post(f,i,function(a){c(JSON.parse(a.text))},d),this}throw new Error("Missing 'status' in tweetWithMedia()")}throw new Error("Missing 'status' in tweetWithMedia()")},retweet:function(a,b,c,d){d=d||{};if(!a)throw new Error("Missing 'id' in retweet()");var e=OAuth.Twitter.API_URL+OAuth.Twitter.API_VERSION+OAuth.Twitter.API_RETWEET+a+"."+OAuth.Twitter.API_FORMAT,f={trimUser:"trim_user",includeEntities:"include_entities"},g={trimUser:!0,includeEntities:truepre},h=handleOptions(d,f,g);return this.oauth.post(e,h,function(a){b(JSON.parse(a.text))},c),this},destroyTweet:function(a,b,c,d){d=d||{};if(!a)throw new Error("Missing 'id' in destroyTweet()");var e=OAuth.Twitter.API_URL+OAuth.Twitter.API_VERSION+OAuth.Twitter.API_DESTROY_TWEET+a+"."+OAuth.Twitter.API_FORMAT,f={trimUser:"trim_user",includeEntities:"include_entities"},g={trimUser:!0,includeEntities:!0},h=handleOptions(d,f,g);return this.oauth.post(e,h,function(a){b(JSON.parse(a.text))},c),this},showTweet:function(a,b,c,d){d=d||{};if(!a)throw new Error("Missing 'id' in showTweet()");var e=OAuth.Twitter.API_URL+OAuth.Twitter.API_VERSION+OAuth.Twitter.API_TWEET+a+"."+OAuth.Twitter.API_FORMAT,f={trimUser:"trim_user",includeEntities:"include_entities"},g={trimUser:!0,includeEntities:!0},h=handleOptions(d,f,g);return this.oauth.post(e,h,function(a){b(JSON.parse(a.text))},c),this}},exports.Client=Client,exports.OAuth=OAuth;function Client(a,b,c,d){this.STACKMOB_APP_NAME=a,this.STACKMOB_PUBLIC_KEY=b,this.STACKMOB_PRIVATE_KEY=c,this.STACKMOB_USER_OBJECT_NAME=d||"user",this.ENDPOINT="http://stackmob.mob1.stackmob.com/api/0/"+a+"/",this.oauth=OAuth({consumerKey:b,consumerSecret:c}),Ti.API.debug(JSON.stringify(this))}function handleOptions(a,b,c){var d,e={};for(d in b)b.hasOwnProperty(d)&&(d in a?e[b[d]]=a[d]:d in c&&(e[b[d]]=c[d]));return e}function optionsToQueryString(a,b,c){var d=handleOptions(a,b,c),e=[],f;for(f in d)e.push(f+"="+d[f]);return"?"+e.join("&")}var exports=exports||this,OAuth=function(a){function b(a){var b=arguments,c=b.callee,d=b.length,e,f=this;if(this instanceof c){for(e in a)a.hasOwnProperty(e)&&(f[e]=a[e]);return f}return new c(a)}function c(){}function d(a){var b=arguments,c=b.callee,d,f,g,h,i,j,k,l=/^([^:\/?#]+?:\/\/)*([^\/:?#]*)?(:[^\/?#]*)*([^?#]*)(\?[^#]*)?(#(.*))*/,m=this;if(!(this instanceof c))return new c(a);m.scheme="",m.host="",m.port="",m.path="",m.query=new e,m.anchor="";if(a!==null){d=a.match(l),f=d[1],g=d[2],h=d[3],i=d[4],j=d[5],k=d[6],f=f!==undefined?f.replace("://","").toLowerCase():"http",h=h?h.replace(":",""):f==="https"?"443":"80",f=f=="http"&&h==="443"?"https":f,j=j?j.replace("?",""):"",k=k?k.replace("#",""):"";if(f==="https"&&h!=="443"||f==="http"&&h!=="80")g=g+":"+h;m.scheme=f,m.host=g,m.port=h,m.path=i||"/",m.query.setQueryParams(j),m.anchor=k||""}}function e(a){var b=arguments,c=b.callee,d=b.length,e,f=this;if(this instanceof c){if(a!=undefined)for(e in a)a.hasOwnProperty(e)&&(f[e]=a[e]);return f}return new c(a)}function g(a){return this instanceof g?this.init(a):new g(a)}function h(a){var b=[],c,d;for(c in a)a[c]&&a[c]!==undefined&&a[c]!==""&&(c==="realm"?d=c+'="'+a[c]+'"':b.push(c+'="'+g.urlEncode(a[c]+"")+'"'));return b.sort(),d&&b.unshift(d),b.join(", ")}function i(a,b,c,d){var e=[],f,h=g.urlEncode;for(f in c)c[f]!==undefined&&c[f]!==""&&e.push(g.urlEncode(f)+"="+g.urlEncode(c[f]+""));for(f in d)d[f]!==undefined&&d[f]!==""&&(c[f]||e.push(h(f)+"="+h(d[f]+"")));return[a,h(b),h(e.sort().join("&"))].join("&")}function j(){return parseInt(+(new Date)/1e3,10)}function k(a){function b(){return Math.floor(Math.random()*h.length)}a=a||64;var c=a/8,d="",e=c/4,f=c%4,g,h=["20","21","22","23","24","25","26","27","28","29","2A","2B","2C","2D","2E","2F","30","31","32","33","34","35","36","37","38","39","3A","3B","3C","3D","3E","3F","40","41","42","43","44","45","46","47","48","49","4A","4B","4C","4D","4E","4F","50","51","52","53","54","55","56","57","58","59","5A","5B","5C","5D","5E","5F","60","61","62","63","64","65","66","67","68","69","6A","6B","6C","6D","6E","6F","70","71","72","73","74","75","76","77","78","79","7A","7B","7C","7D","7E"];for(g=0;g<e;g++)d+=h[b()]+h[b()]+h[b()]+h[b()];for(g=0;g<f;g++)d+=h[b()];return d}function l(){var a;return a=Titanium.Network.createHTTPClient(),a}function m(a){var b=new Array(++a);return b.join(0).split("")}function n(a){var b=[],c,d;for(d=0;d<a.length;d++)c=a.charCodeAt(d),c<128?b.push(c):c<2048?b.push(192+(c>>6),128+(c&63)):c<65536?b.push(224+(c>>12),128+(c>>6&63),128+(c&63)):c<2097152&&b.push(240+(c>>18),128+(c>>12&63),128+(c>>6&63),128+(c&63));return b}function o(a){var b=[],c;for(c=0;c<a.length*32;c+=8)b.push(a[c>>>5]>>>24-c%32&255);return b}function p(a){var b=[],c=a.length,d;for(d=0;d<c;d++)b.push((a[d]>>>4).toString(16)),b.push((a[d]&15).toString(16));return b.join("")}function q(a){var b="",c=a.length,d;for(d=0;d<c;d++)b+=String.fromCharCode(a[d]);return b}function r(a,b){return a<<b|a>>>32-b}function s(a){if(a!==undefined){var b=a,c,d;return b.constructor===String&&(b=n(b)),this instanceof s?c=this:c=new s(a),d=c.hash(b),p(d)}return this instanceof s?this:new s}function t(a,b,c,d){var e=n(b),f=n(c),g=e.length,h,i,j,k;g>a.blocksize&&(e=a.hash(e),g=e.length),e=e.concat(m(a.blocksize-g)),i=e.slice(0),j=e.slice(0);for(k=0;k<a.blocksize;k++)i[k]^=92,j[k]^=54;return h=a.hash(i.concat(a.hash(j.concat(f)))),d?p(h):q(h)}c.prototype={join:function(a){return a=a||"",this.values().join(a)},keys:function(){var a,b=[],c=this;for(a in c)c.hasOwnProperty(a)&&b.push(a);return b},values:function(){var a,b=[],c=this;for(a in c)c.hasOwnProperty(a)&&b.push(c[a]);return b},shift:function(){throw"not implimented"},unshift:function(){throw"not implimented"},push:function(){throw"not implimented"},pop:function(){throw"not implimented"},sort:function(){throw"not implimented"},ksort:function(a){var b=this,c=b.keys(),d,e,f;a==undefined?c.sort():c.sort(a);for(d=0;d<c.length;d++)f=c[d],e=b[f],delete b[f],b[f]=e;return b},toObject:function(){var a={},b,c=this;for(b in c)c.hasOwnProperty(b)&&(a[b]=c[b]);return a}},b.prototype=new c,d.prototype={scheme:"",host:"",port:"",path:"",query:"",anchor:"",toString:function(){var a=this,b=a.query+"";return a.scheme+"://"+a.host+a.path+(b!=""?"?"+b:"")+(a.anchor!==""?"#"+a.anchor:"")}},e.prototype=new b,e.prototype.toString=function(){var a,b=this,c=[],d="",e="",f=g.urlEncode;b.ksort();for(a in b)b.hasOwnProperty(a)&&a!=undefined&&b[a]!=undefined&&(e=f(a)+"="+f(b[a]),c.push(e));return c.length>0&&(d=c.join("&")),d},e.prototype.setQueryParams=function(a){var b=arguments,c=b.length,d,e,f,g=this,h;if(c==1){if(typeof a=="object")for(d in a)a.hasOwnProperty(d)&&(g[d]=a[d]);else if(typeof a=="string"){e=a.split("&");for(d=0,f=e.length;d<f;d++)h=e[d].split("="),g[h[0]]=h[1]}}else for(d=0;d<arg_length;d+=2)g[b[d]]=b[d+1]};var f="1.0";return g.prototype={realm:"",requestTokenUrl:"",authorizationUrl:"",accessTokenUrl:"",init:function(a){var b="",c={enablePrivilege:a.enablePrivilege||!1,callbackUrl:a.callbackUrl||"oob",consumerKey:a.consumerKey,consumerSecret:a.consumerSecret,accessTokenKey:a.accessTokenKey||b,accessTokenSecret:a.accessTokenSecret||b,verifier:b,signatureMethod:a.signatureMethod||"HMAC-SHA1"};return this.realm=a.realm||b,this.requestTokenUrl=a.requestTokenUrl||b,this.authorizationUrl=a.authorizationUrl||b,this.accessTokenUrl=a.accessTokenUrl||b,this.getAccessToken=function(){return[c.accessTokenKey,c.accessTokenSecret]},this.getAccessTokenKey=function(){return c.accessTokenKey},this.getAccessTokenSecret=function(){return c.accessTokenSecret},this.setAccessToken=function(a,b){b&&(a=[a,b]),c.accessTokenKey=a[0],c.accessTokenSecret=a[1]},this.getVerifier=function(){return c.verifier},this.setVerifier=function(a){c.verifier=a},this.setCallbackUrl=function(a){c.callbackUrl=a},this.request=function(a){var b,e,m,n,o,p,q,r,s,t,u,v,w=[],x,y={},z,A;b=a.method||"GET",e=d(a.url),m=a.data||{},n=a.headers||{},o=a.success||function(){},p=a.failure||function(){},A=function(){var a=!1;for(var b in m)m[b]&&typeof m[b].fileName!="undefined"&&(a=!0);return a}(),x=a.appendQueryString?a.appendQueryString:!1,c.enablePrivilege&&netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead UniversalBrowserWrite"),q=l(),q.onreadystatechange=function(){if(q.readyState===4){var a=/^(.*?):\s*(.*?)\r?$/mg,b=n,c={},d="",e;if(!q.getAllResponseHeaders){if(!!q.getResponseHeaders){d=q.getResponseHeaders();for(var f=0,g=d.length;f<g;++f)c[d[f][0]]=d[f][1]}}else{d=q.getAllResponseHeaders();while(e=a.exec(d))c[e[1]]=e[2]}var h={text:q.responseText,requestHeaders:b,responseHeaders:c};q.status>=200&&q.status<=226||q.status==304||q.status===0?o(h):q.status>=400&&q.status!==0&&p(h)}},s={oauth_callback:c.callbackUrl,oauth_consumer_key:c.consumerKey,oauth_token:c.accessTokenKey,oauth_signature_method:c.signatureMethod,oauth_timestamp:j(),oauth_nonce:k(),oauth_verifier:c.verifier,oauth_version:f},t=c.signatureMethod;if((!("Content-Type"in n)||n["Content-Type"]=="application/x-www-form-urlencoded")&&!A){z=e.query.toObject();for(r in z)y[r]=z[r];for(r in m)y[r]=m[r]}urlString=e.scheme+"://"+e.host+e.path,u=i(b,urlString,s,y),v=g.signatureMethod[t](c.consumerSecret,c.accessTokenSecret,u),s.oauth_signature=v,this.realm&&(s.realm=this.realm);if(x||b=="GET")e.query.setQueryParams(m),w=null;else if(!A)if(typeof m=="string")w=m,"Content-Type"in n||(n["Content-Type"]="text/plain");else{for(r in m)w.push(g.urlEncode(r)+"="+g.urlEncode(m[r]+""));w=w.sort().join("&"),"Content-Type"in n||(n["Content-Type"]="application/x-www-form-urlencoded")}else if(A){w=new FormData;for(r in m)w.append(r,m[r])}q.open(b,e+"",!0),q.setRequestHeader("Authorization","OAuth "+h(s)),q.setRequestHeader("X-Requested-With","XMLHttpRequest");for(r in n)q.setRequestHeader(r,n[r]);q.send(w)},this},get:function(a,b,c){this.request({url:a,success:b,failure:c})},post:function(a,b,c,d){this.request({method:"POST",url:a,data:b,success:c,failure:d})},getJSON:function(a,b,c){this.get(a,function(a){b(JSON.parse(a.text))},c)},postJSON:function(a,b,c,d){this.post(a,JSON.stringify(b),function(a){c(JSON.parse(a.text))},d)},parseTokenRequest:function(a){var b=0,c=a.split("&"),d=c.length,e={};for(;b<d;++b){var f=c[b].split("=");e[g.urlDecode(f[0])]=g.urlDecode(f[1])}return e},fetchRequestToken:function(a,b){var c=this;c.setAccessToken("","");var d=c.authorizationUrl;this.get(this.requestTokenUrl,function(b){var e=c.parseTokenRequest(b.text);c.setAccessToken([e.oauth_token,e.oauth_token_secret]),a(d+"?"+b.text)},b)},fetchAccessToken:function(a,b){var c=this;this.get(this.accessTokenUrl,function(b){var d=c.parseTokenRequest(b.text);c.setAccessToken([d.oauth_token,d.oauth_token_secret]),c.setVerifier(""),a(b)},b)}},g.signatureMethod={"HMAC-SHA1":function(b,c,d){var e,f,h=g.urlEncode;return b=h(b),c=h(c||""),e=b+"&"+c,f=t(s.prototype,e,d),a.btoa(f)}},g.urlEncode=function(a){function b(a){var b=a.toString(16).toUpperCase();return b.length<2&&(b=0+b),"%"+b}if(!a)return"";a=a+"";var c=/[ \r\n!*"'();:@&=+$,\/?%#\[\]<>{}|`^\\\u0080-\uffff]/,d=a.length,e,f=a.split(""),g;for(e=0;e<d;e++)if(g=f[e].match(c))g=g[0].charCodeAt(0),g<128?f[e]=b(g):g<2048?f[e]=b(192+(g>>6))+b(128+(g&63)):g<65536?f[e]=b(224+(g>>12))+b(128+(g>>6&63))+b(128+(g&63)):g<2097152&&(f[e]=b(240+(g>>18))+b(128+(g>>12&63))+b(128+(g>>6&63))+b(128+(g&63)));return f.join("")},g.urlDecode=function(a){return a?a.replace(/%[a-fA-F0-9]{2}/ig,function(a){return String.fromCharCode(parseInt(a.replace("%",""),16))}):""},s.prototype=new s,s.prototype.blocksize=64,s.prototype.hash=function(a){function A(a,b,c,d){switch(a){case 0:return b&c|~b&d;case 1:case 3:return b^c^d;case 2:return b&c|b&d|c&d}return-1}var b=[1732584193,4023233417,2562383102,271733878,3285377520],c=[1518500249,1859775393,2400959708,3395469782],d,e,f,g,h,i,j,k,l,p,q,s,t,u,v,w,x,y,z;a.constructor===String&&(a=n(a.encodeUTF8())),f=a.length,g=Math.ceil((f+9)/this.blocksize)*this.blocksize-(f+9),e=Math.floor(f/4294967296),d=Math.floor(f%4294967296),h=[e*8>>24&255,e*8>>16&255,e*8>>8&255,e*8&255,d*8>>24&255,d*8>>16&255,d*8>>8&255,d*8&255],a=a.concat([128],m(g),h),i=Math.ceil(a.length/this.blocksize);for(j=0;j<i;j++){k=a.slice(j*this.blocksize,(j+1)*this.blocksize),l=k.length,p=[];for(q=0;q<l;q++)p[q>>>2]|=k[q]<<24-(q-(q>>2)*4)*8;s=b[0],t=b[1],u=b[2],v=b[3],w=b[4];for(x=0;x<80;x++)x>=16&&(p[x]=r(p[x-3]^p[x-8]^p[x-14]^p[x-16],1)),y=Math.floor(x/20),z=r(s,5)+A(y,t,u,v)+w+c[y]+p[x],w=v,v=u,u=r(t,30),t=s,s=z;b[0]+=s,b[1]+=t,b[2]+=u,b[3]+=v,b[4]+=w}return o(b)},g}(this);(function(a){var b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";a.btoa=a.btoa||function(a){var c=0,d=a.length,e,f,g="";for(;c<d;c+=3)e=[a.charCodeAt(c),a.charCodeAt(c+1),a.charCodeAt(c+2)],f=[e[0]>>2,(e[0]&3)<<4|e[1]>>4,(e[1]&15)<<2|e[2]>>6,e[2]&63],isNaN(e[1])&&(f[2]=64),isNaN(e[2])&&(f[3]=64),g+=b.charAt(f[0])+b.charAt(f[1])+b.charAt(f[2])+b.charAt(f[3]);return g}})(this),Client.prototype.request=function(a){var b=this,c={};c=extend(c,a.headers);if(a.method==="PUT"||a.method==="POST")c=extend(c,{"Content-Type":"application/json"});var d={method:a.method,headers:c,url:b.ENDPOINT+a.action,data:a.method==="PUT"||a.method==="POST"?JSON.stringify(a.params):a.params,success:function(b){var c=JSON.stringify(b);a.success!==undefined&&a.success(b)},failure:function(b){var c=JSON.stringify(b);Ti.API.error(String.format("fail: %s - %s",a.action,c)),a.error!==undefined&&a.error(b)}};b.oauth.request(d)},Client.prototype.create=function(a){this.request({action:a.className,method:"POST",params:a.params,success:a.success,error:a.error,headers:a.headers})},Client.prototype.linkUserWithTwitter=function(a){this.request({action:(a.className||"user")+"/linkUserWithTwitter",method:"GET",params:{tw_ts:Ti.App.Properties.getString("TwitterOAuthTokenSecret"),tw_tk:Ti.App.Properties.getString("TwitterOAuthTokenKey")},success:a.success,error:a.error,headers:a.headers})},Client.prototype.twitterStatusUpdate=function(a){this.request({action:(a.className||"user")+"/twitterStatusUpdate",method:"GET",params:{tw_st:a.message},success:a.success||a.success,error:a.error||a.error,headers:a.headers||a.headers})},Client.prototype.login=function(a){this.request({action:(a.className||"user")+"/login",method:"GET",params:{username:a.username,password:a.password},success:a.success,error:a.error,headers:a.headers})},Client.prototype.get=function(a){this.request({action:a.className+(a.objectId?"/"+a.objectId:""),method:"GET",params:a.params,success:a.success,error:a.error,headers:a.headers})},Client.prototype.getNear=function(a){var b={"location[near]":a.params.lon+","+a.params.lat+","+(a.params.dist_miles?a.params.dist_miles/3963:a.params.dist)};this.request({action:a.className,method:"GET",params:b,success:a.success,error:a.error,headers:a.headers})},Client.prototype.getWithin=function(a){var b,c={};b=a.params.dist_miles?a.params.dist_miles/3963:a.params.dist,a.params.lon!==null&&a.params.lat?c={"location[near]":a.params.lon+","+a.params.lat+","+b}:c={"location[within]":a.params.bottomLeft.lon+","+a.params.bottomLeft.lat+","+a.params.topRight.lon+","+a.params.topRight.lat+","+b},this.request({action:a.className,method:"GET",params:c,success:a.success,error:a.error,headers:a.headers})},Client.prototype.update=function(a){this.request({action:a.className+"/"+encodeURIComponent(a.objectId),method:"PUT",params:a.params,success:a.success,error:a.error,headers:a.headers})},Client.prototype.remove=function(a){this.request({action:a.className+"/"+a.objectId,method:"DELETE",success:a.success,error:a.error,headers:a.headers})},exports.base64FromFile=function(a){var b=Titanium.Platform.osname=="android",c=a.read();if(b)return String.format("Content-Type: %s\nContent-Transfer-Encoding: base64\n\n%s",c.mimeType,c.toBase64());var d=require("com.clearlyinnovative.utils");return String.format("Content-Type: %s\nContent-Transfer-Encoding: base64\n\n%s",c.mimeType,d.base64encode(c))};var extend=function(a,b){if(arguments.length>2)for(var c=1;c<arguments.length;c++)extend(a,arguments[c]);else for(var d in b)a[d]=b[d];return a};OAuth.Twitter=function(a){if(!(this instanceof OAuth.Twitter))return new OAuth.Twitter(a);var b=Ti.App.Properties,c=b.hasProperty("TwitterOAuthTokenKey")?b.getString("TwitterOAuthTokenKey"):"",d=b.hasProperty("TwitterOAuthTokenSecret")?b.getString("TwitterOAuthTokenSecret"):"";"accessTokenKey"in a||(a.accessTokenKey=c,a.accessTokenSecret=d),a.requestTokenUrl=OAuth.Twitter.API_URL+OAuth.Twitter.API_OAUTH_REQUEST_TOKEN,a.authorizationUrl=OAuth.Twitter.API_URL+OAuth.Twitter.API_OAUTH_AUTHENTICATE,a.accessTokenUrl=OAuth.Twitter.API_URL+OAuth.Twitter.API_OAUTH_ACCESS_TOKEN,a.callbackUrl="http://bytespider.eu/oauth/",this.oauth=new OAuth(a)},OAuth.Twitter.API_OAUTH_AUTHORISE="oauth/authorize",OAuth.Twitter.API_OAUTH_AUTHENTICATE="oauth/authenticate",OAuth.Twitter.API_OAUTH_ACCESS_TOKEN="oauth/access_token",OAuth.Twitter.API_OAUTH_REQUEST_TOKEN="oauth/request_token",OAuth.Twitter.API_URL="https://api.twitter.com/",OAuth.Twitter.API_UPLOAD_URL="https://upload.twitter.com/",OAuth.Twitter.API_VERSION="1",OAuth.Twitter.API_FORMAT="json",OAuth.Twitter.API_VARIFY_CREDENTIALS="/account/verify_credentials",OAuth.Twitter.API_HOME_TIMELINE="/statuses/home_timeline",OAuth.Twitter.API_USER_TIMELINE="/statuses/user_timeline",OAuth.Twitter.API_PUBLIC_TIMELINE="/statuses/public_timeline",OAuth.Twitter.API_MENTIONS="/statuses/mentions",OAuth.Twitter.API_RETWEETED_BY_ME="/statuses/retweeted_by_me",OAuth.Twitter.API_RETWEETS_OF_ME="/statuses/retweets_of_me",OAuth.Twitter.API_RETWEETED_TO_USER="/statuses/retweeted_to_user",OAuth.Twitter.API_RETWEETED_BY_USER="/statuses/retweeted_by_user",OAuth.Twitter.API_STATUS_UPDATE="/statuses/update",OAuth.Twitter.API_STATUS_UPDATE_WITH_MEDIA="/statuses/update_with_media",OAuth.Twitter.API_TWEET="/statuses/retweet/",OAuth.Twitter.API_RETWEET="/statuses/retweet/",OAuth.Twitter.API_DESTROY_TWEET="/statuses/destroy/",OAuth.Twitter.API_MESSAGES="/direct_messages",OAuth.Twitter.API_NEW_MESSAGE="/direct_messages/new",OAuth.Twitter.API_MESSAGE="/direct_messages/",OAuth.Twitter.UI=function(){var a,b=Titanium.UI.createButton({title:"Cancel"}),c,d;return a=Titanium.UI.createWindow({title:"Twitter",leftNavButton:b}),b.addEventListener("click",function(a){OAuth.Twitter.UI.hide(),d&&d("cancelled")}),{show:function(b,e,f){var g=this;c=e,d=f;var h=Ti.UI.createWebView({autoDetect:[Ti.UI.AUTODETECT_NONE],url:b});a.add(h),h.addEventListener("load",function(b){var e=b.url;if(e.indexOf("oauth_verifier")==-1&&e.indexOf("denied")==-1)return;if(e.indexOf("denied")!=-1){OAuth.Twitter.UI.hide(),a.remove(h),d&&d(e);return}if(e.indexOf("oauth_verifier")!=-1){OAuth.Twitter.UI.hide(),a.remove(h),c&&c(e);return}}),a.open({modal:!0,modalTransitionStyle:Ti.UI.iPhone.MODAL_TRANSITION_STYLE_COVER_VERTICAL,modalStyle:Ti.UI.iPhone.MODAL_PRESENTATION_FORMSHEET})},hide:function(){a.close()}}}(),OAuth.Twitter.prototype={authenticate:function(a,b,c){c=c||{};var d=this;if(!a)throw new Error("Success callback is required in authenticate()");if("username"in c&&"password"in c){var e=OAuth.Twitter.API_URL+OAuth.Twitter.API_OAUTH_ACCESS_TOKEN;d.oauth.post(e,{x_auth_username:c.username,x_auth_password:c.password,x_auth_mode:"client_auth"},a,b)}else d.oauth.fetchRequestToken(function(c){OAuth.Twitter.UI.show(c,function(c){var e=c.substr(c.indexOf("?")),f=d.oauth.parseTokenRequest(e);d.oauth.setVerifier(f.oauth_verifier),d.oauth.fetchAccessToken(function(b){d.storeToken.call(d),a(b)},b)},b)},function(a){OAuth.Twitter.UI.hide.call(d),b&&b(a)});return this},deauthenticate:function(){return this.oauth.setAccessToken(null,null),Ti.App.Properties.removeProperty("TwitterOAuthTokenKey"),Ti.App.Properties.removeProperty("TwitterOAuthTokenSecret"),this},storeToken:function(){var a=this.oauth.getAccessTokenKey(),b=this.oauth.getAccessTokenSecret();Ti.App.Properties.setString("TwitterOAuthTokenKey",a),Ti.App.Properties.setString("TwitterOAuthTokenSecret",b)},signedIn:function(){var a=!1,b=!1,c=Ti.App.Properties;return c.hasProperty("TwitterOAuthTokenKey")&&(a=c.getString("TwitterOAuthTokenKey")),c.hasProperty("TwitterOAuthTokenSecret")&&(b=c.getString("TwitterOAuthTokenSecret")),a!==!1&&b!==!1},verifyCredentials:function(a,b,c){c=c||{};var d=OAuth.Twitter.API_URL+OAuth.Twitter.API_VERSION+OAuth.Twitter.API_VARIFY_CREDENTIALS+"."+OAuth.Twitter.API_FORMAT,e={},f={};return d+=optionsToQueryString(c,e,f),this.oauth.getJSON(d,a,b),this},homeTimeline:function(a,b,c,d){d=d||{};var e=OAuth.Twitter.API_URL+OAuth.Twitter.API_VERSION+OAuth.Twitter.API_HOME_TIMELINE+"."+OAuth.Twitter.API_FORMAT;a!==null&&(d.sinceid=a);var f={sinceId:"since_id",count:"count",page:"page",maxId:"max_id",trimUser:"trim_user",includeRetweets:"include_rts",includeEntities:"include_entities",excludeReplies:"exclude_replies",contributorDetails:"contributor_details"},g={trimUser:!0,includeRetweets:!0,includeEntities:!0,excludeReplies:!1,contributorDetails:!0};return e+=optionsToQueryString(d,f,g),this.oauth.getJSON(e,b,c),this},userTimeline:function(a,b,c,d,e){e=e||{};var f=OAuth.Twitter.API_URL+OAuth.Twitter.API_VERSION+OAuth.Twitter.API_USER_TIMELINE+"."+OAuth.Twitter.API_FORMAT,g=parseInt(a,10);g==a?e.userId=g:e.screenName=a;var h={screenName:"screen_name",userId:"user_id",count:"count",page:"page",maxId:"max_id",trimUser:"trim_user",includeRetweets:"include_rts",includeEntities:"include_entities",excludeReplies:"exclude_replies",contributorDetails:"contributor_details"},i={trimUser:!0,includeRetweets:!0,includeEntities:!0,excludeReplies:!1,contributorDetails:!0};return f+=optionsToQueryString(e,h,i),this.oauth.getJSON(f,c,d),this},mentions:function(a,b,c){c=c||{};var d=OAuth.Twitter.API_URL+OAuth.Twitter.API_VESRION+OAuth.Twitter.API_MENTIONS+"."+OAuth.Twitter.API_FORMAT,e={count:"count",page:"page",maxId:"max_id",trimUser:"trim_user",includeRetweets:"include_rts",includeEntities:"include_entities",excludeReplies:"exclude_replies",contributorDetails:"contributor_details"},f={trimUser:!0,includeRetweets:!0,includeEntities:!0,excludeReplies:!1,contributorDetails:!0};return d+=optionsToQueryString(c,e,f),this.oauth.getJSON(d,a,b),this},messages:function(a,b,c){c=c||{};var d=OAuth.Twitter.API_URL+OAuth.Twitter.API_VESRION+OAuth.Twitter.API_MESSAGES+"."+OAuth.Twitter.API_FORMAT,e={count:"count",page:"page",maxId:"max_id",sinceId:"since_id",includeEntities:"include_entities",skipStatus:"skip_status"},f={skipStatus:!0,includeEntities:!0};return d+=optionsToQueryString(c,e,f),this.oauth.getJSON(d,a,b),this},createMessage:function(a,b,c){c=c||{};var d=OAuth.Twitter.API_URL+OAuth.Twitter.API_VESRION+OAuth.Twitter.API_NEW_MESSAGE+"."+OAuth.Twitter.API_FORMAT,e={userId:"user_id",screenName:"screen_name",text:"text",wrapLinks:"wrap_links"},f={wrapLinks:!0},g=handleOptions(c,e,f);return this.oauth.post(d,g,function(b){a(JSON.parse(b.text))},b),this},showMessage:function(a,b,c,d){d=d||{};var e=OAuth.Twitter.API_URL+OAuth.Twitter.API_VESRION+OAuth.Twitter.API_MESSAGE+a+"."+OAuth.Twitter.API_FORMAT,f={},g={};return e+=optionsToQueryString(d,f,g),this.oauth.getJSON(e,b,c),this},retweets:function(a,b,c){c=c||{};var d=OAuth.Twitter.API_URL+OAuth.Twitter.API_VESRION+OAuth.Twitter.API_RETWEETS_OF_ME+"."+OAuth.Twitter.API_FORMAT,e={count:"count",page:"page",maxId:"max_id",trimUser:"trim_user",includeEntities:"include_entities"},f={trimUser:!0,includeEntities:!0};return d+=optionsToQueryString(c,e,f),this.oauth.getJSON(d,a,b),this},retweetsByMe:function(a,b,c){c=c||{};var d=OAuth.Twitter.API_URL+OAuth.Twitter.API_VESRION+OAuth.Twitter.API_RETWEETED_BY_ME+"."+OAuth.Twitter.API_FORMAT,e={count:"count",page:"page",maxId:"max_id",trimUser:"trim_user",includeEntities:"include_entities"},f={trimUser:!0,includeEntities:!0};return d+=optionsToQueryString(c,e,f),this.oauth.getJSON(d,a,b),this},tweet:function(a,b,c,d){d=d||{};var e=OAuth.Twitter.API_URL+OAuth.Twitter.API_VERSION+OAuth.Twitter.API_STATUS_UPDATE+"."+OAuth.Twitter.API_FORMAT;if(!a)throw new Error("Missing 'status' in tweet()");d.status=a;var f={status:"status",inReplyTo:"in_reply_to_status_id",lat:"lat","long":"long",place:"place_id",displayCoordinates:"display_coordinates",trimUser:"trim_user",includeEntities:"include_entities",wrap_linksinks:"wrap_links"},g={trimUser:!0,includeEntities:!0,wrapLinks:!0},h=handleOptions(d,f,g);return this.oauth.post(e,h,function(a){b(JSON.parse(a.text))},c),this},tweetWithMedia:function(a,b,c,d,e){e=e||{};var f=OAuth.Twitter.API_UPLOAD_URL+OAuth.Twitter.API_VERSION+OAuth.Twitter.API_STATUS_UPDATE_WITH_MEDIA+"."+OAuth.Twitter.API_FORMAT;if("status"in e){if("media"in e){e.status=a,e.media=b;var g={status:"status",media:"media",possiblySensitive:"possibly_sensitive",inReplyTo:"in_reply_to_status_id",lat:"lat","long":"long",place:"place_id",displayCoordinates:"display_coordinates",trimUser:"trim_user",includeEntities:"include_entities",wrap_linksinks:"wrap_links"},h={trimUser:!0,includeEntities:!0,wrapLinks:!0},i=handleOptions(e,g,h);return this.oauth.post(f,i,function(a){c(JSON.parse(a.text))},d),this}throw new Error("Missing 'status' in tweetWithMedia()")}throw new Error("Missing 'status' in tweetWithMedia()")},retweet:function(a,b,c,d){d=d||{};if(!a)throw new Error("Missing 'id' in retweet()");var e=OAuth.Twitter.API_URL+OAuth.Twitter.API_VERSION+OAuth.Twitter.API_RETWEET+a+"."+OAuth.Twitter.API_FORMAT,f={trimUser:"trim_user",includeEntities:"include_entities"},g={trimUser:!0,includeEntities:truepre},h=handleOptions(d,f,g);return this.oauth.post(e,h,function(a){b(JSON.parse(a.text))},c),this},destroyTweet:function(a,b,c,d){d=d||{};if(!a)throw new Error("Missing 'id' in destroyTweet()");var e=OAuth.Twitter.API_URL+OAuth.Twitter.API_VERSION+OAuth.Twitter.API_DESTROY_TWEET+a+"."+OAuth.Twitter.API_FORMAT,f={trimUser:"trim_user",includeEntities:"include_entities"},g={trimUser:!0,includeEntities:!0},h=handleOptions(d,f,g);return this.oauth.post(e,h,function(a){b(JSON.parse(a.text))},c),this},showTweet:function(a,b,c,d){d=d||{};if(!a)throw new Error("Missing 'id' in showTweet()");var e=OAuth.Twitter.API_URL+OAuth.Twitter.API_VERSION+OAuth.Twitter.API_TWEET+a+"."+OAuth.Twitter.API_FORMAT,f={trimUser:"trim_user",includeEntities:"include_entities"},g={trimUser:!0,includeEntities:!0},h=handleOptions(d,f,g);return this.oauth.post(e,h,function(a){b(JSON.parse(a.text))},c),this}},exports.Client=Client,exports.OAuth=OAuth;